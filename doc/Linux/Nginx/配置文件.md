---
title: 配置文件
url: https://www.yuque.com/tangsanghegedan/ilyegg/pgkb1a
---

<a name="zWcVq"></a>

# 请求代理转发

请求 http://dev.b0x0.top/api/test.html 代理URL: http://127.0.0.1:8877/test.html

```bash
server {
		listen       80;
		server_name dev.b0x0.top;

		
		location / {
			# 前端页面
			root /usr/local/front/dev/bfp/;
			index index.html index.htm;
			try_files  $uri $uri/ /index.html;
		}

		location /api {
			# 后台服务
      add_header Access-Control-Allow-Origin *;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header REMOTE-HOST $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_pass http://127.0.0.1:8877/;
		}
		
}
```

<a name="BFevp"></a>

# 负载均衡

```bash
upstream server_test{
	192.168.8.10:8877;
  192.168.8.10:8878;
  
}
server {
		listen       80;
		server_name dev.b0x0.top;

		location /api {
			# 后台服务
      add_header Access-Control-Allow-Origin *;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header REMOTE-HOST $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_pass http://server_test/;
		}
		
}
```

<a name="FzFWk"></a>

# HTTPS

```bash
server {
        listen 80;
        server_name www.dev.b0x0.top;
        rewrite ^(.*)$ https://$host$1 permanent;
    }

    server {
        listen 443 ssl;
        server_name  www.dev.b0x0.top;

        ssl_certificate /etc/letsencrypt/live/www.dev.b0x0.top/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/www.dev.b0x0.top/privkey.pem;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
        ssl_prefer_server_ciphers on;

        gzip on;
        gzip_buffers 32 4k;
        gzip_comp_level 6;
        gzip_min_length 200;
        gzip_types text/css text/xml application/javascript text/plain application/x-javascript application/xml text/javascript image/jpeg image/gif image/png;
        gzip_vary on;

        location / {
          	# 前端页面
            root /home/server/front;
            index index.html index.htm;
            try_files  $uri $uri/ /index.html;
        }

        location /api {
          	# 后台服务
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header REMOTE-HOST $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_pass http://localhost:30000/;
            proxy_http_version 1.1;
            proxy_set_header Connection "";
        }
    }
```

<a name="ZjYYp"></a>

# 文件预览/下载

访问: http//dev.b0x0.top/file/download/test.html 就会去找/home/file/文件夹下面的文件

```bash
	server {
			listen       80;
			server_name  dev.b0x0.top;

			# 文件下载
			location /file/download {
			   add_header Content-Disposition attachment;   
			   alias /home/file;
			}
      
		 # 文件预览
		 location /file/preview {
			   charset utf-8;
			   add_header Content-Type text/plain;
			   alias /home/file;
		 }
		 
}
```
