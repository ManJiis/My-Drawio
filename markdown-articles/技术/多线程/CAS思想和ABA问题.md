

# [比较并交换-维基百科](https://zh.wikipedia.org/wiki/%E6%AF%94%E8%BE%83%E5%B9%B6%E4%BA%A4%E6%8D%A2)



# [ABA问题-知乎](https://www.zhihu.com/question/23281499/answer/854522984)



# CAS思想：

CAS就是compare and swap（比较交换），是一种很出名的**无锁的算法，就是可以不使用锁机制实现线程间的同步**。使用CAS线程是不会被阻塞的，所以又称为非阻塞同步。CAS算法涉及到三个操作：

- 需要读取内存值V
- 进行比较的旧值A
- 准备写入的新值B

当V的值等于A的值的时候，才用B的值去更新V的值，否则不会执行任何操作（比较和替换是一个原子操作-A和V比较，V和B替换），一般情况下是一个自旋操作，即在失败的情形不断重试（比较浪费CPU资源）。
** 

# 缺点：

**ABA问题**：如果另一个线程修改V值假设原来是A，先修改成B，再修改回成A。当前线程的CAS操作无法分辨当前V值是否发生过变化。

关于ABA问题我想了一个例子：在你非常渴的情况下你发现一个盛满水的杯子，你一饮而尽。之后再给杯子里重新倒满水。然后你离开，当杯子的真正主人回来时看到杯子还是盛满水，他当然不知道是否被人喝完重新倒满。解决这个问题的方案的一个策略是每一次倒水假设有一个自动记录仪记录下，这样主人回来就可以分辨在她离开后是否发生过重新倒满的情况。这也是解决ABA问题目前采用的策略。
